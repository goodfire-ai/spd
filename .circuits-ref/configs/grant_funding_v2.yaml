# Attribution Graph Pipeline - Grant Funding Decision Circuits v2
# Explores what factors influence yes/no funding decisions
# Uses unique slugs to avoid filename collisions
#
# Key findings so far:
#   - MIT + $500K + AI Safety: "No" (44.9%)
#   - Community College + $500K + AI Safety: "No" (71.1%)
#   - MIT + $50M + AI Safety: "No" (77.3%)
#
# New experiments: Try to find scenarios that flip to "Yes"
#
# Usage:
#   python scripts/analyze.py --config configs/grant_funding_v2.yaml

config:
  # Model settings
  model_name: "meta-llama/Llama-3.1-8B-Instruct"
  device: "cuda"
  dtype: "bfloat16"

  # Graph generation
  k: 5
  tau: 0.005

  # Template
  use_chat_template: true
  answer_prefix: ""

  # Labeling
  label_neurons: true

  # Clustering
  skip_special_tokens: true
  min_cluster_size: 5
  max_cluster_depth: 1

  # LLM Analysis
  run_llm_analysis: true
  llm_model: "auto"
  llm_provider: "auto"

  # Functional splitting
  functional_split: true
  functional_split_min_size: 10
  use_prompt_answer_split: true
  use_position_split: true
  max_position_gap: 3
  use_layer_split: false
  use_semantic_split: false
  use_llm_split: true

  # Output
  output_dir: "outputs/grant_v2/"
  save_intermediate: true

sequences:
  # Try different framings that might lead to "Yes"

  # Experiment 1: More detailed positive framing
  - prompt: "You are reviewing a grant proposal. Dr. Maria Rodriguez, a leading AI researcher at Stanford with 50 publications, requests $200,000 to develop safety testing tools for language models. Her preliminary results show 40% improvement in detecting harmful outputs. Fund this proposal? yes or no"
    answer_prefix: " Answer:"

  # Experiment 2: Urgent/important framing
  - prompt: "URGENT: A $100,000 grant request from Harvard Medical School to study AI-assisted cancer diagnosis. Early trials show 95% accuracy. The research could save thousands of lives. Should we fund it? yes or no"
    answer_prefix: " Answer:"

  # Experiment 3: Simple, small, uncontroversial
  - prompt: "A professor requests $10,000 to buy equipment for teaching undergraduate physics. Should we approve this small equipment grant? yes or no"
    answer_prefix: " Answer:"

  # Experiment 4: Negative framing to ensure strong "No"
  - prompt: "An unknown researcher with no publications requests $5,000,000 to study astrology prediction algorithms. No preliminary data provided. Should we fund this? yes or no"
    answer_prefix: " Answer:"
