# Attribution Graph Pipeline - Grant Funding Decision Circuits
# Explores what factors influence yes/no funding decisions
#
# Hypothesis: Decision circuits may differ based on:
#   - Institution prestige (Harvard vs unknown)
#   - Funding amount ($50K vs $5M)
#   - Research area (AI safety vs theoretical)
#   - Professor credentials
#
# Usage:
#   python scripts/analyze.py --config configs/grant_funding.yaml

config:
  # Model settings
  model_name: "meta-llama/Llama-3.1-8B-Instruct"
  device: "cuda"
  dtype: "bfloat16"

  # Graph generation
  k: 5                    # Number of top logits to trace
  tau: 0.005              # Node influence threshold

  # Template
  use_chat_template: true
  answer_prefix: ""

  # Labeling
  label_neurons: true

  # Clustering
  skip_special_tokens: true
  min_cluster_size: 5
  max_cluster_depth: 1

  # LLM Analysis
  run_llm_analysis: true
  llm_model: "auto"
  llm_provider: "auto"

  # Functional splitting
  functional_split: true
  functional_split_min_size: 10
  use_prompt_answer_split: true
  use_position_split: true
  max_position_gap: 3
  use_layer_split: false
  use_semantic_split: false
  use_llm_split: true

  # Output
  output_dir: "outputs/grant_experiments/"
  save_intermediate: true

# Baseline experiments - see what circuits activate for funding decisions
sequences:
  # Experiment 1: High prestige + reasonable amount + hot topic
  - prompt: "You are a government science agency reviewing grant proposals. A proposal requests $500,000 for Dr. Sarah Chen from MIT to study neural network interpretability and AI safety. Should this proposal be funded? Answer yes or no."
    answer_prefix: " Answer:"

  # Experiment 2: Low prestige + same amount + same topic
  - prompt: "You are a government science agency reviewing grant proposals. A proposal requests $500,000 for Dr. John Smith from Westfield Community College to study neural network interpretability and AI safety. Should this proposal be funded? Answer yes or no."
    answer_prefix: " Answer:"

  # Experiment 3: High prestige + large amount
  - prompt: "You are a government science agency reviewing grant proposals. A proposal requests $50,000,000 for Dr. Sarah Chen from MIT to study neural network interpretability and AI safety. Should this proposal be funded? Answer yes or no."
    answer_prefix: " Answer:"

  # Experiment 4: Obscure topic
  - prompt: "You are a government science agency reviewing grant proposals. A proposal requests $500,000 for Dr. Sarah Chen from MIT to study medieval Icelandic poetry analysis. Should this proposal be funded? Answer yes or no."
    answer_prefix: " Answer:"
