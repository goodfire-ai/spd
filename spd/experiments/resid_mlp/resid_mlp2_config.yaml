# ResidualMLP 2 layers
# --- WandB ---
wandb_project: spd
wandb_run_name: null
wandb_run_name_prefix: ""

# --- General ---
seed: 0
C: 400
n_mask_samples: 1
ci_fn_type: shared_mlp
ci_fn_hidden_dims:
  - 256
sigmoid_type: leaky_hard
target_module_patterns:
  - "layers.*.mlp_in"
  - "layers.*.mlp_out"
use_delta_component: true

# --- Loss config ---
loss_metric_configs:
  - classname: "ImportanceMinimalityLoss"
    coeff: 0.0001
    pnorm: 2.0
  - classname: "StochasticReconSubsetLoss"
    coeff: 2.0
  - classname: "PGDReconSubsetLoss"
    coeff: 2.0
    init: random
    step_size: 1.0
    n_steps: 1
    mask_scope: shared_across_batch
  - classname: "FaithfulnessLoss"
    coeff: 0.0
output_loss_type: mse

# --- Training ---
batch_size: 2
eval_batch_size: 2
steps: 100
lr: 3e-4
lr_schedule: constant

# --- Faithfulness Warmup ---
faithfulness_warmup_steps: 10
faithfulness_warmup_lr: 0.01
faithfulness_warmup_weight_decay: 0.0

# --- Logging & Saving ---
train_log_freq: 10
eval_freq: 99999999
slow_eval_freq: 99999999
n_eval_steps: 1
slow_eval_on_first_step: false
save_freq: null
eval_metric_configs:
  - classname: "CIHistograms"
    n_batches_accum: 5
  - classname: "ComponentActivationDensity"
  - classname: "PermutedCIPlots"
    identity_patterns: ["layers.*.mlp_in"]
    dense_patterns: ["layers.*.mlp_out"]
  - classname: "IdentityCIError"
    identity_ci:
      - layer_pattern: "layers.*.mlp_in"
        n_features: 100
    dense_ci:
      - layer_pattern: "layers.*.mlp_out"
        k: 25
  - classname: "CI_L0"
    groups: null
  - classname: "CIMeanPerComponent"
  - classname: "StochasticHiddenActsReconLoss"
  - classname: "PGDReconLoss"
    init: random
    step_size: 0.1
    n_steps: 20
    mask_scope: shared_across_batch
ci_alive_threshold: 0.1
n_examples_until_dead: 1_024_000

# --- Pretrained model info ---
pretrained_model_class: "spd.experiments.resid_mlp.models.ResidMLP"
pretrained_model_path: "wandb:goodfire/spd-pre-Sep-2025/runs/any9ekl9"

# --- Task Specific ---
task_config:
  task_name: resid_mlp
  feature_probability: 0.01
  data_generation_type: "at_least_zero_active"