# ResidualMLP 2 layers
# --- WandB ---
wandb_project: spd
wandb_run_name: null
wandb_run_name_prefix: ""

# --- General ---
seed: 0
C: 200
n_mask_samples: 1
gate_type: "shared_mlp"
gate_hidden_dims: [200]
sigmoid_type: "leaky_hard"
target_module_patterns:
  - "layers.*.mlp_in"
  - "layers.*.mlp_out"
use_delta_component: true
pgd_mask_enabled: true
pgd_mask_random_init: true
pgd_mask_steps: 2
pgd_mask_step_size: 0.5
adv_mix_adv_weight_start: 0.0
adv_mix_adv_weight_end: 1
adv_mix_rand_weight_start: 0
adv_mix_rand_weight_end: 0
adv_mix_start_frac: 0.0
adv_mix_end_frac: 1.0
# --- Loss Coefficients ---
faithfulness_coeff: null
ci_recon_coeff: null
stochastic_recon_coeff: null
ci_recon_layerwise_coeff: null
stochastic_recon_layerwise_coeff: null
stochastic_recon_subset_coeff: 1
ci_masked_recon_subset_coeff: 1
importance_minimality_coeff: 4e-5
# importance_minimality_coeff_end_frac: 0.5
# importance_minimality_coeff_final: 5e-6
# importance_minimality_coeff_start_frac: 0.0
pnorm: 2
p_anneal_start_frac: 0.0
p_anneal_final_p: 0.3
p_anneal_end_frac: 1.0
output_loss_type: mse


# --- Training ---
batch_size: 2048
eval_batch_size: 2048
steps: 20_000
lr: 1e-3
lr_schedule: constant
lr_warmup_pct: 0.00

# --- Logging & Saving ---
train_log_freq: 50
eval_freq: 500
n_eval_steps: 100
slow_eval_freq: 5_000
slow_eval_on_first_step: true
save_freq: null
ci_alive_threshold: 0.1
n_examples_until_dead: 1_024_000
eval_metrics:
  - classname: "CIHistograms"
    extra_init_kwargs:
      n_batches_accum: 5
  - classname: "ComponentActivationDensity"
  - classname: "PermutedCIPlots"
    extra_init_kwargs:
      identity_patterns: ["layers.*.mlp_in"]
      dense_patterns: ["layers.*.mlp_out"]
  - classname: "UVPlots"
    extra_init_kwargs:
      identity_patterns: ["layers.*.mlp_in"]
      dense_patterns: ["layers.*.mlp_out"]
  - classname: "IdentityCIError"
    extra_init_kwargs:
      identity_ci:
        - layer_pattern: "layers.*.mlp_in"
          n_features: 100
      dense_ci:
        - layer_pattern: "layers.*.mlp_out"
          k: 25
  - classname: "CI_L0"
  - classname: "CIMeanPerComponent"
  - classname: "FaithfulnessLoss"


# --- Pretrained model info ---
pretrained_model_class: "spd.experiments.resid_mlp.models.ResidMLP"
pretrained_model_path: "wandb:goodfire/spd-pre-Sep-2025/runs/any9ekl9"

# --- Task Specific ---
task_config:
  task_name: resid_mlp
  feature_probability: 0.01
  data_generation_type: "at_least_zero_active"